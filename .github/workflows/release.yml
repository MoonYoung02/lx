name: GoReleaser

on:
  push:
    tags:
      - "v*"

jobs:
  goreleaser:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true

      # Docker 환경에서 빌드를 실행합니다. (Go, Zig 설치 불필요)
      - name: Run GoReleaser (Cross)
        run: |
          docker run \
            --rm \
            -e GITHUB_TOKEN=$GITHUB_TOKEN \
            -e HOMEBREW_TAP_GITHUB_TOKEN=$HOMEBREW_TAP_GITHUB_TOKEN \
            -v /var/run/docker.sock:/var/run/docker.sock \
            -v $PWD:/src \
            -w /src \
            ghcr.io/goreleaser/goreleaser-cross:v2.23.0 \
            release --clean
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          HOMEBREW_TAP_GITHUB_TOKEN: ${{ secrets.HOMEBREW_TAP_GITHUB_TOKEN }}
